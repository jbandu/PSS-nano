global:
  resolve_timeout: 5m
  # Configure email settings (update with your SMTP server)
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@airline-pss.com'
  smtp_auth_username: 'alerts@airline-pss.com'
  smtp_auth_password: 'your-app-password'
  smtp_require_tls: true

  # Slack webhook (update with your webhook URL)
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

  # PagerDuty integration key (update with your integration key)
  pagerduty_url: 'https://events.pagerduty.com/v2/enqueue'

# Templates for notifications
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# Route tree for alerts
route:
  # Default receiver
  receiver: 'default'

  # Group alerts by these labels
  group_by: ['alertname', 'service', 'severity']

  # Time to wait before sending notification for a group
  group_wait: 30s

  # Time to wait before sending notification about new alerts
  group_interval: 5m

  # Time to wait before sending notification again
  repeat_interval: 4h

  # Child routes
  routes:
    # Critical alerts go to PagerDuty and Slack
    - match:
        severity: critical
      receiver: 'pagerduty-critical'
      continue: true
      routes:
        - match:
            category: business
          receiver: 'slack-business-critical'
        - match:
            category: security
          receiver: 'slack-security-critical'

    # Warning alerts go to Slack
    - match:
        severity: warning
      receiver: 'slack-warnings'
      group_wait: 1m
      group_interval: 10m
      repeat_interval: 12h

    # Business alerts
    - match:
        category: business
      receiver: 'slack-business'
      group_wait: 1m
      repeat_interval: 6h

    # Security alerts
    - match:
        category: security
      receiver: 'slack-security'
      group_wait: 30s
      repeat_interval: 2h

    # Database alerts
    - match:
        category: database
      receiver: 'slack-database'
      repeat_interval: 8h

    # Performance alerts
    - match:
        category: performance
      receiver: 'slack-performance'
      repeat_interval: 8h

# Inhibition rules to suppress notifications
inhibit_rules:
  # Suppress warning if critical alert is firing
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']

  # Suppress downstream service alerts if upstream is down
  - source_match:
      alertname: 'ServiceDown'
      service: 'api-gateway'
    target_match_re:
      alertname: '.*'
    equal: ['environment']

# Receivers configuration
receivers:
  # Default receiver (logs only)
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'

  # PagerDuty for critical alerts
  - name: 'pagerduty-critical'
    pagerduty_configs:
      - service_key: 'YOUR_PAGERDUTY_SERVICE_KEY'
        description: '{{ .GroupLabels.alertname }} - {{ .CommonAnnotations.summary }}'
        severity: '{{ .GroupLabels.severity }}'
        details:
          firing: '{{ .Alerts.Firing | len }}'
          resolved: '{{ .Alerts.Resolved | len }}'
          description: '{{ .CommonAnnotations.description }}'

  # Slack for critical business alerts
  - name: 'slack-business-critical'
    slack_configs:
      - channel: '#alerts-business-critical'
        username: 'AlertManager'
        icon_emoji: ':rotating_light:'
        title: ':rotating_light: CRITICAL BUSINESS ALERT'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Severity:* {{ .GroupLabels.severity }}
          *Service:* {{ .GroupLabels.service }}
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
        send_resolved: true

  # Slack for critical security alerts
  - name: 'slack-security-critical'
    slack_configs:
      - channel: '#alerts-security'
        username: 'AlertManager'
        icon_emoji: ':warning:'
        title: ':warning: CRITICAL SECURITY ALERT'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Severity:* {{ .GroupLabels.severity }}
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
        send_resolved: true

  # Slack for warnings
  - name: 'slack-warnings'
    slack_configs:
      - channel: '#alerts-warnings'
        username: 'AlertManager'
        icon_emoji: ':warning:'
        title: 'Warning Alert'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Service:* {{ .GroupLabels.service }}
          *Summary:* {{ .CommonAnnotations.summary }}
        send_resolved: true

  # Slack for business alerts
  - name: 'slack-business'
    slack_configs:
      - channel: '#alerts-business'
        username: 'AlertManager'
        icon_emoji: ':chart_with_downwards_trend:'
        title: 'Business Metric Alert'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
        send_resolved: true

  # Slack for security alerts
  - name: 'slack-security'
    slack_configs:
      - channel: '#alerts-security'
        username: 'AlertManager'
        icon_emoji: ':lock:'
        title: 'Security Alert'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
        send_resolved: true

  # Slack for database alerts
  - name: 'slack-database'
    slack_configs:
      - channel: '#alerts-database'
        username: 'AlertManager'
        icon_emoji: ':database:'
        title: 'Database Alert'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Service:* {{ .GroupLabels.service }}
          *Summary:* {{ .CommonAnnotations.summary }}
        send_resolved: true

  # Slack for performance alerts
  - name: 'slack-performance'
    slack_configs:
      - channel: '#alerts-performance'
        username: 'AlertManager'
        icon_emoji: ':hourglass:'
        title: 'Performance Alert'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Service:* {{ .GroupLabels.service }}
          *Summary:* {{ .CommonAnnotations.summary }}
        send_resolved: true

  # Email receiver (optional)
  - name: 'email-team'
    email_configs:
      - to: 'oncall@airline-pss.com'
        from: 'alerts@airline-pss.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: 'alerts@airline-pss.com'
        auth_password: 'your-app-password'
        headers:
          Subject: '[{{ .Status | toUpper }}] {{ .GroupLabels.alertname }}'
        html: |
          <h2>Alert: {{ .GroupLabels.alertname }}</h2>
          <p><strong>Severity:</strong> {{ .GroupLabels.severity }}</p>
          <p><strong>Service:</strong> {{ .GroupLabels.service }}</p>
          <p><strong>Summary:</strong> {{ .CommonAnnotations.summary }}</p>
          <p><strong>Description:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>Firing Alerts:</strong> {{ .Alerts.Firing | len }}</p>
