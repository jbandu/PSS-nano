# Server Configuration
NODE_ENV=development
PORT=3006
SERVICE_NAME=payment-service

# Database (Neon PostgreSQL - Production)
DATABASE_URL="postgresql://neondb_owner:npg_kp4AVvbJxf9i@ep-steep-rain-a49rnsg4-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require&schema=public"

# Database (Local Development - Optional)
# DATABASE_URL="postgresql://user:password@localhost:5432/airline_ops?schema=public"

# Redis (Payment Sessions & Token Cache)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=5
REDIS_KEY_PREFIX=pay:
SESSION_TTL=1800

# Encryption Keys (MUST BE CHANGED IN PRODUCTION)
# Generate with: openssl rand -base64 32
ENCRYPTION_KEY=CHANGE_ME_32_BYTE_BASE64_KEY_HERE
ENCRYPTION_ALGORITHM=aes-256-gcm
TOKEN_ENCRYPTION_KEY=CHANGE_ME_ANOTHER_32_BYTE_KEY

# Stripe Configuration (Primary Gateway)
STRIPE_ENABLED=true
STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx
STRIPE_API_VERSION=2023-10-16
STRIPE_CAPTURE_METHOD=manual
STRIPE_STATEMENT_DESCRIPTOR=AIRLINE OPS

# PayPal Configuration
PAYPAL_ENABLED=true
PAYPAL_MODE=sandbox
PAYPAL_CLIENT_ID=xxxxx
PAYPAL_CLIENT_SECRET=xxxxx
PAYPAL_WEBHOOK_ID=xxxxx

# Adyen Configuration (European Markets)
ADYEN_ENABLED=true
ADYEN_ENVIRONMENT=test
ADYEN_API_KEY=xxxxx
ADYEN_MERCHANT_ACCOUNT=AirlineOpsEU
ADYEN_CLIENT_KEY=xxxxx
ADYEN_HMAC_KEY=xxxxx

# Gateway Selection Strategy
PRIMARY_GATEWAY=stripe
FALLBACK_GATEWAY=adyen
GATEWAY_ROUTING_RULES=geo,currency,amount
ENABLE_GATEWAY_FAILOVER=true
FAILOVER_TIMEOUT=5000

# Payment Methods
CREDIT_CARD_ENABLED=true
DEBIT_CARD_ENABLED=true
APPLE_PAY_ENABLED=true
GOOGLE_PAY_ENABLED=true
PAYPAL_ENABLED=true
ALIPAY_ENABLED=false
WECHAT_PAY_ENABLED=false
BANK_TRANSFER_ENABLED=true
VOUCHER_ENABLED=true

# Card Brands
VISA_ENABLED=true
MASTERCARD_ENABLED=true
AMEX_ENABLED=true
DISCOVER_ENABLED=true
DINERS_ENABLED=false
JCB_ENABLED=false
UNIONPAY_ENABLED=false

# 3D Secure / SCA Configuration
ENABLE_3DS=true
FORCE_3DS_FOR_AMOUNT=500.00
FORCE_3DS_FOR_REGIONS=EU,UK
ENABLE_3DS2=true
3DS_CHALLENGE_PREFERENCE=no_preference

# Payment Flow
AUTHORIZATION_VALIDITY_HOURS=168
AUTO_CAPTURE_ENABLED=true
AUTO_CAPTURE_HOURS_BEFORE_DEPARTURE=72
ENABLE_DEFERRED_CAPTURE=true
ENABLE_SPLIT_PAYMENTS=true
MAX_SPLIT_METHODS=3
PAYMENT_TIMEOUT=30000

# Fraud Detection
ENABLE_FRAUD_DETECTION=true
FRAUD_SERVICE_PROVIDER=stripe_radar
FRAUD_THRESHOLD_LOW=30
FRAUD_THRESHOLD_MEDIUM=50
FRAUD_THRESHOLD_HIGH=75
BLOCK_HIGH_RISK_COUNTRIES=false
HIGH_RISK_COUNTRIES=

# Velocity Checks
ENABLE_VELOCITY_CHECKS=true
MAX_TRANSACTIONS_PER_CARD_HOURLY=3
MAX_TRANSACTIONS_PER_IP_HOURLY=5
MAX_AMOUNT_PER_CARD_DAILY=10000.00
MAX_FAILED_ATTEMPTS_HOURLY=3

# AVS & CVV
REQUIRE_AVS_CHECK=true
AVS_REJECTION_CODES=N,Z
REQUIRE_CVV=true
CVV_REJECTION=true

# Refunds
ENABLE_REFUNDS=true
ALLOW_PARTIAL_REFUNDS=true
REFUND_TO_ORIGINAL_METHOD=true
ENABLE_VOUCHER_REFUNDS=true
VOUCHER_BONUS_PERCENTAGE=10
REFUND_PROCESSING_TIMEOUT=60000
MAX_REFUND_WINDOW_DAYS=365

# Chargebacks
ENABLE_CHARGEBACK_ALERTS=true
CHARGEBACK_WEBHOOK_URL=
AUTO_ACCEPT_CHARGEBACKS=false

# Multi-Currency
DEFAULT_CURRENCY=USD
SUPPORTED_CURRENCIES=USD,EUR,GBP,CAD,AUD,JPY,CNY,INR,SGD,HKD,MXN,BRL,CHF,SEK,NOK,DKK,ZAR,AED,NZD,THB
ENABLE_DYNAMIC_CURRENCY_CONVERSION=true
DCC_MARKUP_PERCENTAGE=3.0
SETTLEMENT_CURRENCY=USD

# FX Rates
FX_PROVIDER=openexchangerates
FX_API_URL=https://openexchangerates.org/api/latest.json
FX_API_KEY=
FX_UPDATE_INTERVAL=3600000
FX_CACHE_TTL=3600

# Payment Gateway Fees
STRIPE_PERCENTAGE_FEE=2.9
STRIPE_FIXED_FEE=0.30
PAYPAL_PERCENTAGE_FEE=3.49
PAYPAL_FIXED_FEE=0.49
ADYEN_PERCENTAGE_FEE=2.5
ADYEN_FIXED_FEE=0.00
INCLUDE_FEES_IN_TOTAL=false

# Reconciliation
ENABLE_RECONCILIATION=true
RECONCILIATION_SCHEDULE=0 2 * * *
RECONCILIATION_RETENTION_DAYS=2555
AUTO_RECONCILE_THRESHOLD=0.01
SETTLEMENT_DELAY_DAYS=2

# Security & Compliance
PCI_COMPLIANCE_MODE=true
ENABLE_TOKENIZATION=true
TOKEN_VAULT_PROVIDER=stripe
MASK_CARD_NUMBERS=true
CARD_MASKING_PATTERN=XXXX-XXXX-XXXX-####
LOG_SENSITIVE_DATA=false
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_RETENTION_DAYS=2555

# Data Encryption
ENCRYPT_DATA_AT_REST=true
ENCRYPT_DATA_IN_TRANSIT=true
TLS_VERSION=1.3
CIPHER_SUITES=TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256

# GDPR Compliance
ENABLE_GDPR_MODE=true
DATA_RETENTION_DAYS=2555
ANONYMIZE_AFTER_DAYS=90
ENABLE_RIGHT_TO_ERASURE=true

# Performance & Timeouts
PAYMENT_PROCESSING_TIMEOUT=30000
GATEWAY_REQUEST_TIMEOUT=10000
MAX_RETRY_ATTEMPTS=3
RETRY_DELAY_MS=1000
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60000

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100
PAYMENT_RATE_LIMIT_MAX=10

# Webhooks
ENABLE_WEBHOOKS=true
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_TIMEOUT=5000
WEBHOOK_SIGNATURE_VALIDATION=true

# External Services
RESERVATION_SERVICE_URL=http://localhost:3002
NOTIFICATION_SERVICE_URL=http://localhost:3007
FRAUD_SERVICE_URL=

# Monitoring
ENABLE_METRICS=true
METRICS_PORT=9006
TRACK_PAYMENT_SUCCESS_RATE=true
TRACK_GATEWAY_PERFORMANCE=true
TRACK_FRAUD_DETECTION_RATE=true

# Alerting
ALERT_ON_HIGH_FAILURE_RATE=true
FAILURE_RATE_THRESHOLD=0.05
ALERT_ON_HIGH_FRAUD_RATE=true
FRAUD_RATE_THRESHOLD=0.02
ALERT_EMAIL=payments@airline-ops.com

# Testing & Development
ENABLE_TEST_CARDS=false
SIMULATE_PAYMENT_DELAYS=false
MOCK_GATEWAY_RESPONSES=false

# CORS
CORS_ORIGIN=http://localhost:3000,http://localhost:3001

# Logging
LOG_LEVEL=info
LOG_DIR=logs
MASK_LOGS=true

# Feature Flags
ENABLE_APPLE_PAY=true
ENABLE_GOOGLE_PAY=true
ENABLE_INSTALLMENTS=false
ENABLE_BUY_NOW_PAY_LATER=false
ENABLE_CRYPTO_PAYMENTS=false
ENABLE_SAVED_CARDS=true
ENABLE_AUTO_RELOAD=false

# Business Rules
MIN_PAYMENT_AMOUNT=1.00
MAX_PAYMENT_AMOUNT=100000.00
INSTALLMENT_MIN_AMOUNT=500.00
INSTALLMENT_MAX_PERIODS=12
VOUCHER_VALIDITY_DAYS=365

# Dispute Management
ENABLE_DISPUTE_MANAGEMENT=true
AUTO_RESPOND_TO_DISPUTES=false
DISPUTE_RESPONSE_DEADLINE_DAYS=7
EVIDENCE_UPLOAD_ENABLED=true

# Settlement
SETTLEMENT_FREQUENCY=daily
SETTLEMENT_TIME=02:00
SETTLEMENT_BATCH_SIZE=1000
ENABLE_SETTLEMENT_REPORTS=true

# Compliance Reporting
ENABLE_PCI_REPORTS=true
ENABLE_AML_REPORTS=false
ENABLE_TRANSACTION_REPORTS=true
TRANSACTION_REPORT_SCHEDULE=0 3 * * *

# Support
PAYMENT_SUPPORT_EMAIL=payment-support@airline-ops.com
PAYMENT_SUPPORT_PHONE=+1-800-AIRLINE

