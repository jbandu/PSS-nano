# ============================================================================
# ANALYTICS SERVICE CONFIGURATION
# ============================================================================

NODE_ENV=development
PORT=3015
SERVICE_NAME=analytics-service

# ============================================================================
# DATABASE CONNECTIONS
# ============================================================================

# OLTP Database (Source - Operational Data)
OLTP_DATABASE_URL=postgresql://user:password@localhost:5432/airline_pss?schema=public

# OLAP Database (Data Warehouse)
OLAP_DATABASE_URL=postgresql://user:password@localhost:5432/airline_analytics?schema=public

# Alternative: ClickHouse for OLAP
# CLICKHOUSE_URL=http://localhost:8123
# CLICKHOUSE_DATABASE=airline_analytics
# CLICKHOUSE_USER=default
# CLICKHOUSE_PASSWORD=

# Alternative: Snowflake for Cloud Data Warehouse
# SNOWFLAKE_ACCOUNT=your_account
# SNOWFLAKE_USER=analytics_user
# SNOWFLAKE_PASSWORD=
# SNOWFLAKE_WAREHOUSE=ANALYTICS_WH
# SNOWFLAKE_DATABASE=AIRLINE_ANALYTICS
# SNOWFLAKE_SCHEMA=PUBLIC

# ============================================================================
# REDIS CACHE
# ============================================================================

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=5
REDIS_TTL_SECONDS=3600

# Query result cache
CACHE_ENABLED=true
CACHE_TTL_MINUTES=60
CACHE_MAX_SIZE_MB=1024

# ============================================================================
# ETL CONFIGURATION
# ============================================================================

# ETL Schedule (cron format)
ETL_BOOKING_SCHEDULE=0 */1 * * * *    # Every hour
ETL_REVENUE_SCHEDULE=0 0 * * * *      # Daily at midnight
ETL_OPERATIONAL_SCHEDULE=0 */6 * * * * # Every 6 hours
ETL_ANCILLARY_SCHEDULE=0 */2 * * * *   # Every 2 hours
ETL_DIMENSION_SCHEDULE=0 0 2 * * *     # Daily at 2 AM
ETL_AGGREGATION_SCHEDULE=0 0 3 * * *   # Daily at 3 AM

# ETL Batch Sizes
ETL_BATCH_SIZE=1000
ETL_MAX_RETRIES=3
ETL_RETRY_DELAY_MS=5000

# ETL Mode
ETL_MODE=INCREMENTAL  # INCREMENTAL or FULL_LOAD
ETL_LOOKBACK_DAYS=7   # For incremental loads

# Data Source Endpoints
SOURCE_RESERVATION_API=http://localhost:3001
SOURCE_PAYMENT_API=http://localhost:3002
SOURCE_DCS_API=http://localhost:3010
SOURCE_INVENTORY_API=http://localhost:3003
SOURCE_ANCILLARY_API=http://localhost:3006

# ============================================================================
# DATA QUALITY
# ============================================================================

# Quality checks enabled
DATA_QUALITY_ENABLED=true
DATA_QUALITY_ON_FAILURE=ALERT  # ALERT, STOP, CONTINUE

# Quality thresholds
QUALITY_COMPLETENESS_THRESHOLD=0.95        # 95% completeness
QUALITY_ACCURACY_THRESHOLD=0.98            # 98% accuracy
QUALITY_CONSISTENCY_THRESHOLD=0.99         # 99% consistency
QUALITY_TIMELINESS_THRESHOLD_HOURS=24      # Data should be < 24h old

# Duplicate detection
DUPLICATE_CHECK_ENABLED=true
DUPLICATE_CHECK_COLUMNS=pnrLocator,bookingReference

# Anomaly detection
ANOMALY_DETECTION_ENABLED=true
ANOMALY_DETECTION_SENSITIVITY=MEDIUM  # LOW, MEDIUM, HIGH
ANOMALY_DETECTION_WINDOW_DAYS=30

# ============================================================================
# DATA RETENTION
# ============================================================================

# Hot data (fast SSD)
HOT_DATA_RETENTION_MONTHS=12
HOT_DATA_STORAGE_TYPE=SSD

# Warm data (standard storage)
WARM_DATA_RETENTION_YEARS=5
WARM_DATA_STORAGE_TYPE=STANDARD

# Cold data (archive)
COLD_DATA_RETENTION_YEARS=7
COLD_DATA_STORAGE_TYPE=ARCHIVE

# Automatic archival
AUTO_ARCHIVAL_ENABLED=true
ARCHIVAL_SCHEDULE=0 0 1 * * *  # Monthly on 1st

# Data deletion
AUTO_DELETE_EXPIRED_DATA=false  # Safety: disabled by default
DELETE_CONFIRMATION_REQUIRED=true

# ============================================================================
# PERFORMANCE OPTIMIZATION
# ============================================================================

# Partitioning
PARTITION_ENABLED=true
PARTITION_BY=date
PARTITION_INTERVAL=MONTH

# Compression
COMPRESSION_ENABLED=true
COMPRESSION_ALGORITHM=ZSTD  # ZSTD, LZ4, GZIP

# Columnar storage (Parquet)
PARQUET_EXPORT_ENABLED=true
PARQUET_EXPORT_PATH=/data/parquet

# Indexing
AUTO_INDEX_ENABLED=true
INDEX_REBUILD_SCHEDULE=0 0 0 * * 0  # Weekly on Sunday

# Materialized views refresh
MATERIALIZED_VIEWS_ENABLED=true
MATERIALIZED_VIEWS_REFRESH_SCHEDULE=0 30 * * * *  # Every hour at :30

# ============================================================================
# QUERY PERFORMANCE
# ============================================================================

# Query timeout
QUERY_TIMEOUT_SECONDS=300
SLOW_QUERY_THRESHOLD_SECONDS=10

# Query result limits
MAX_RESULT_ROWS=100000
DEFAULT_RESULT_ROWS=1000

# Pagination
DEFAULT_PAGE_SIZE=100
MAX_PAGE_SIZE=1000

# ============================================================================
# REPORTING & EXPORTS
# ============================================================================

# Export formats
EXPORT_CSV_ENABLED=true
EXPORT_EXCEL_ENABLED=true
EXPORT_JSON_ENABLED=true
EXPORT_PARQUET_ENABLED=true

# Export limits
MAX_EXPORT_ROWS=1000000
EXPORT_TIMEOUT_SECONDS=600

# Scheduled reports
SCHEDULED_REPORTS_ENABLED=true
REPORT_OUTPUT_PATH=/data/reports

# Email reports
EMAIL_REPORTS_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
REPORT_EMAIL_FROM=analytics@airline.com
REPORT_EMAIL_TO=

# ============================================================================
# DATA LINEAGE
# ============================================================================

DATA_LINEAGE_TRACKING=true
LINEAGE_GRAPH_ENABLED=true

# ============================================================================
# MONITORING & ALERTING
# ============================================================================

# Monitoring
MONITORING_ENABLED=true
METRICS_COLLECTION_INTERVAL_SECONDS=60

# Alerting
ALERTING_ENABLED=true
ALERT_EMAIL=ops@airline.com
ALERT_SLACK_WEBHOOK=

# Alert thresholds
ALERT_ETL_FAILURE=true
ALERT_QUALITY_FAILURE=true
ALERT_QUERY_SLOW_THRESHOLD_SECONDS=30
ALERT_DISK_USAGE_THRESHOLD_PERCENT=85

# ============================================================================
# SECURITY
# ============================================================================

# Authentication
JWT_SECRET=your-jwt-secret-here
API_KEY=your-api-key-here
API_KEY_HEADER=X-API-Key

# Authorization
RBAC_ENABLED=true
ALLOWED_ROLES=analyst,manager,executive,admin

# Rate limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# IP Whitelist
IP_WHITELIST_ENABLED=false
IP_WHITELIST=127.0.0.1,10.0.0.0/8

# ============================================================================
# LOGGING
# ============================================================================

LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE_PATH=./logs/analytics.log
LOG_ROTATION=daily
LOG_MAX_FILES=30

# Query logging
LOG_QUERIES=true
LOG_QUERY_PARAMS=false  # Security: don't log sensitive params

# ============================================================================
# EXTERNAL INTEGRATIONS
# ============================================================================

# Weather data (for operational analytics)
WEATHER_API_ENABLED=false
WEATHER_API_URL=https://api.openweathermap.org
WEATHER_API_KEY=

# Competitor pricing (for revenue management)
COMPETITOR_PRICING_ENABLED=false
COMPETITOR_PRICING_API=

# Market intelligence
MARKET_INTELLIGENCE_ENABLED=false
MARKET_INTELLIGENCE_API=

# ============================================================================
# AIRFLOW (ETL Orchestration)
# ============================================================================

AIRFLOW_ENABLED=false
AIRFLOW_URL=http://localhost:8080
AIRFLOW_USERNAME=admin
AIRFLOW_PASSWORD=

# ============================================================================
# DBT (Data Build Tool)
# ============================================================================

DBT_ENABLED=false
DBT_PROFILES_DIR=/path/to/dbt/profiles
DBT_PROJECT_DIR=/path/to/dbt/project

# ============================================================================
# FEATURE FLAGS
# ============================================================================

FEATURE_REAL_TIME_ANALYTICS=false
FEATURE_PREDICTIVE_ANALYTICS=false
FEATURE_CUSTOMER_360=true
FEATURE_REVENUE_OPTIMIZATION=true
FEATURE_OPERATIONAL_INSIGHTS=true
