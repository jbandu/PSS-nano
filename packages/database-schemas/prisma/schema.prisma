generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  AGENT
  CUSTOMER
  SYSTEM
}

enum Status {
  ACTIVE
  INACTIVE
  PENDING
  DELETED
}

enum FlightStatus {
  SCHEDULED
  BOARDING
  DEPARTED
  IN_FLIGHT
  LANDED
  CANCELLED
  DELAYED
}

enum CabinClass {
  ECONOMY
  PREMIUM_ECONOMY
  BUSINESS
  FIRST
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  BANK_TRANSFER
}

enum NotificationType {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
  DELIVERED
}

enum NotificationTemplate {
  BOOKING_CONFIRMATION
  PAYMENT_CONFIRMATION
  FLIGHT_REMINDER
  FLIGHT_CANCELLATION
  FLIGHT_DELAY
  CHECK_IN_REMINDER
  BOARDING_PASS
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  firstName     String
  lastName      String
  role          UserRole       @default(CUSTOMER)
  status        Status         @default(ACTIVE)
  emailVerified Boolean        @default(false)
  phoneNumber   String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  reservations  Reservation[]
  payments      Payment[]
  notifications Notification[]

  @@index([email])
  @@index([status])
  @@map("users")
}

model Flight {
  id                  String        @id @default(uuid())
  flightNumber        String
  airlineCode         String
  departureAirport    String
  arrivalAirport      String
  scheduledDeparture  DateTime
  scheduledArrival    DateTime
  actualDeparture     DateTime?
  actualArrival       DateTime?
  status              FlightStatus  @default(SCHEDULED)
  aircraftType        String
  capacity            Int
  availableSeats      Int
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  reservations        Reservation[]
  inventories         Inventory[]
  seats               Seat[]

  @@index([flightNumber])
  @@index([departureAirport, arrivalAirport])
  @@index([scheduledDeparture])
  @@index([status])
  @@map("flights")
}

model Seat {
  id              String      @id @default(uuid())
  flightId        String
  seatNumber      String
  cabinClass      CabinClass
  isAvailable     Boolean     @default(true)
  price           Float?
  isEmergencyExit Boolean     @default(false)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  flight          Flight      @relation(fields: [flightId], references: [id], onDelete: Cascade)

  @@unique([flightId, seatNumber])
  @@index([flightId, isAvailable])
  @@map("seats")
}

model Inventory {
  id              String      @id @default(uuid())
  flightId        String
  cabinClass      CabinClass
  totalSeats      Int
  availableSeats  Int
  bookedSeats     Int         @default(0)
  blockedSeats    Int         @default(0)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  flight          Flight      @relation(fields: [flightId], references: [id], onDelete: Cascade)

  @@unique([flightId, cabinClass])
  @@index([flightId])
  @@map("inventories")
}

model Passenger {
  id             String       @id @default(uuid())
  reservationId  String
  firstName      String
  lastName       String
  dateOfBirth    DateTime
  passportNumber String?
  nationality    String?
  email          String?
  phoneNumber    String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  reservation    Reservation  @relation(fields: [reservationId], references: [id], onDelete: Cascade)

  @@index([reservationId])
  @@map("passengers")
}

model Reservation {
  id            String            @id @default(uuid())
  userId        String
  pnr           String            @unique
  status        ReservationStatus @default(PENDING)
  flightId      String
  cabinClass    CabinClass
  seatNumbers   String[]
  totalAmount   Float
  currency      String            @default("USD")
  paymentStatus String            @default("PENDING")
  bookingDate   DateTime          @default(now())
  expiryDate    DateTime
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  user          User              @relation(fields: [userId], references: [id])
  flight        Flight            @relation(fields: [flightId], references: [id])
  passengers    Passenger[]
  payments      Payment[]

  @@index([userId])
  @@index([pnr])
  @@index([flightId])
  @@index([status])
  @@map("reservations")
}

model Payment {
  id              String        @id @default(uuid())
  reservationId   String
  userId          String
  amount          Float
  currency        String        @default("USD")
  status          PaymentStatus @default(PENDING)
  method          PaymentMethod
  transactionId   String?
  gatewayResponse Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  reservation     Reservation   @relation(fields: [reservationId], references: [id])
  user            User          @relation(fields: [userId], references: [id])

  @@index([reservationId])
  @@index([userId])
  @@index([status])
  @@map("payments")
}

model Notification {
  id          String               @id @default(uuid())
  userId      String
  type        NotificationType
  template    NotificationTemplate
  recipient   String
  subject     String?
  content     String
  status      NotificationStatus   @default(PENDING)
  metadata    Json?
  sentAt      DateTime?
  deliveredAt DateTime?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  user        User                 @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([type])
  @@map("notifications")
}
